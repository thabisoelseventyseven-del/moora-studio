<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Dashboard - Moora Studio</title>
<link rel="stylesheet" href="style.css">
<style>
/* --- Base Styles --- */
body {
    font-family: Arial, sans-serif;
    margin: 0;
    background: #f5f5f5; /* Light mode default */
    color: #111;
    transition: all 0.3s;
}
body.dark-theme {
    background: #0f0f15;
    color: #eee;
}

.top-left-nav {
    display:flex;
    gap:10px;
    padding:16px 20px;
    justify-content:flex-end;
    align-items:center;
    position: sticky;
    top:0;
    background: inherit;
    z-index: 1000;
}

.btn {
    background: linear-gradient(135deg,#50e3c2,#ff6ec7);
    color: #fff;
    padding: 10px 18px;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    text-decoration: none;
    font-weight: 600;
}
.small-btn { font-size: 0.9rem; }

.header {
    text-align:center;
    padding: 40px 20px 20px;
}
.header h1 {
    font-size: 2.6rem;
    margin-bottom: 8px;
}
.header p { font-size:1.1rem; color: #666; }

.dashboard-container {
    max-width: 1100px;
    margin: 20px auto;
    padding: 0 20px 60px;
}

/* --- Templates --- */
.dashboard-section h2 { font-size:1.6rem; margin-bottom:12px; }
.dashboard-cards {
    display:flex;
    flex-wrap:wrap;
    gap:18px;
}
.dashboard-card {
    background:#1c1c27;
    border-radius:14px;
    padding:20px;
    flex:1 1 240px;
    text-align:center;
    cursor:pointer;
    color:#fff;
    transition: all 0.2s;
}
.dashboard-card.selected-template {
    border:3px solid #ff6ec7;
    background:#29293f;
}
.dashboard-card div.icon {
    font-size: 48px;
    margin-bottom:8px;
}
.template-price {
    font-size: 1rem;
    margin-top:6px;
    color:#ffd6f0;
}

/* --- Message Box --- */
.message-card {
    background:#1a1a28;
    padding:20px;
    border-radius:14px;
    margin-top:20px;
}
#messageBox {
    width:100%;
    min-height:120px;
    padding:12px;
    border-radius:10px;
    background:#0f0f15;
    color:#eee;
    border:1px solid #333;
    resize:vertical;
}
#selectedTemplatesDisplay {
    font-size:1.1rem;
    font-weight:600;
    color:#ffd6f0;
    margin-bottom:12px;
}

/* --- Inbox preview --- */
.inbox-section {
    margin-top:30px;
}
.inbox-list {
    margin-top:12px;
}
.inbox-item {
    background:#29293f;
    padding:16px;
    border-radius:12px;
    margin-bottom:12px;
    color:#fff;
}

/* --- Badge --- */
.badge {
    background:#ff6ec7;
    color:#fff;
    border-radius:999px;
    padding:4px 10px;
    font-size:0.85rem;
    margin-left:6px;
    display:none;
}

/* --- Responsive --- */
@media(max-width:720px){
    .dashboard-cards{ flex-direction: column; }
}
</style>
</head>

<body>

<!-- Top Navigation -->
<div class="top-left-nav">
    <button id="themeToggle" class="btn small-btn">ðŸŒ™</button>
    <button id="logoutBtn" class="btn small-btn">Logout</button>
    <a href="inbox.html" class="btn small-btn">Inbox <span id="inboxBadge" class="badge">0</span></a>
</div>

<header class="header">
    <h1>Welcome, <span id="userName">User</span></h1>
    <p>Select templates and send a message to admin (text or voice)</p>
</header>

<main class="dashboard-container">

<section class="dashboard-section">
<h2>Choose Templates</h2>
<div id="templatesContainer" class="dashboard-cards"></div>
<div id="selectedTemplatesDisplay">Selected: None</div>
</section>

<section class="dashboard-section">
<h2>Your Message</h2>
<div class="message-card">
<textarea id="messageBox" placeholder="Write your message here or record a voice note"></textarea>
<br><br>
<button id="sendBtn" class="btn">Send to Admin</button>
<p id="statusNote" style="color:#50e3c2;font-weight:700;display:none;margin-top:10px"></p>
</div>
</section>

<section class="dashboard-section inbox-section">
<h2>Inbox (Admin Replies)</h2>
<div id="inboxList" class="inbox-list"></div>
</section>

</main>

<script>
/* --- User Setup --- */
let user = JSON.parse(sessionStorage.getItem('user'));
if(!user){ user={name:"Demo User",email:"demo@example.com"}; sessionStorage.setItem('user',JSON.stringify(user)); }
document.getElementById('userName').textContent=user.name;

/* --- Templates --- */
const templates = [
  {name:"Business",price:"R250",icon:"ðŸ’¼"},
  {name:"Portfolio",price:"R200",icon:"ðŸŽ¨"},
  {name:"Landing Page",price:"R300",icon:"ðŸŒ"},
  {name:"Marketing",price:"R180",icon:"ðŸ“£"},
  {name:"CV Creation",price:"R100",icon:"ðŸ“"},
  {name:"University Application",price:"R150",icon:"ðŸŽ“"},
  {name:"Report Templates",price:"R120",icon:"ðŸ“Š"},
  {name:"Web Templates",price:"R350",icon:"ðŸ’»"}
];
let selectedTemplates=[];
const templatesContainer = document.getElementById('templatesContainer');
const selectedTemplatesDisplay = document.getElementById('selectedTemplatesDisplay');

templates.forEach((t)=>{
  const div=document.createElement('div');
  div.className='dashboard-card';
  div.innerHTML=`<div class="icon">${t.icon}</div><b>${t.name}</b><div class="template-price">${t.price}</div>`;
  div.addEventListener('click', ()=>{
      if(!selectedTemplates.includes(t.name)){
          selectedTemplates.push(t.name);
          div.classList.add('selected-template');
          selectedTemplatesDisplay.innerHTML = 'Selected: ' + selectedTemplates.map(n=>{
            const item = templates.find(tt=>tt.name===n);
            return item.icon+' '+item.name;
          }).join(' | ');
      }
  });
  templatesContainer.appendChild(div);
});

/* --- Inbox helpers --- */
function jsonGet(key,def=[]){try{return JSON.parse(localStorage.getItem(key)||'null')||def}catch(e){return def}}
function jsonSet(key,val){localStorage.setItem(key,JSON.stringify(val))}

/* --- Send message --- */
const sendBtn = document.getElementById('sendBtn');
const messageBox = document.getElementById('messageBox');
const statusNote = document.getElementById('statusNote');

sendBtn.addEventListener('click', ()=>{
    const text = messageBox.value.trim();
    if(selectedTemplates.length===0){ alert('Select at least one template'); return; }
    if(!text){ alert('Add text or voice'); return; }

    const inbox = jsonGet('inbox',[]);
    inbox.push({
        id:'m_'+Date.now(),
        userName:user.name,
        userEmail:user.email,
        templates:selectedTemplates.slice(),
        message:text,
        userVoice:null,
        replyText:null,
        adminVoice:null,
        repliedAt:null,
        replyRead:false,
        sentAt:new Date().toISOString()
    });
    jsonSet('inbox',inbox);

    messageBox.value='';
    selectedTemplates=[];
    document.querySelectorAll('.dashboard-card.selected-template').forEach(el=>el.classList.remove('selected-template'));
    selectedTemplatesDisplay.innerHTML='Selected: None';
    statusNote.style.display='block';
    statusNote.textContent='Message sent to admin';
    setTimeout(()=>statusNote.style.display='none',2500);
    renderInbox();
});

/* --- Inbox Rendering --- */
const inboxList = document.getElementById('inboxList');
const inboxBadge = document.getElementById('inboxBadge');

function renderInbox(){
    const inbox = jsonGet('inbox',[]);
    const replies = inbox.filter(m => m.userEmail===user.email && (m.replyText || m.adminVoice));
    inboxList.innerHTML='';
    if(replies.length===0){ inboxList.innerHTML='<p>No replies from admin.</p>'; }
    else{
        replies.forEach(m=>{
            const div=document.createElement('div');
            div.className='inbox-item';
            div.innerHTML=`${m.adminVoice?'<audio controls src="'+m.adminVoice+'"></audio>':''}
                           ${m.replyText?'<p>'+m.replyText+'</p>':''}
                           <small>Templates: ${m.templates.join(' | ')}</small>`;
            inboxList.appendChild(div);
            if(!m.replyRead) m.replyRead=true;
        });
        jsonSet('inbox',inbox);
    }
    updateBadge();
}

function updateBadge(){
    const inbox = jsonGet('inbox',[]);
    const unread = inbox.filter(m=>m.userEmail===user.email && (m.replyText || m.adminVoice) && !m.replyRead).length;
    if(unread>0){ inboxBadge.style.display='inline-block'; inboxBadge.textContent=unread; }
    else{ inboxBadge.style.display='none'; }
}

/* --- Theme & Logout --- */
const themeToggle = document.getElementById('themeToggle');
themeToggle.addEventListener('click', ()=>{
    document.body.classList.toggle('dark-theme');
    if(document.body.classList.contains('dark-theme')){ localStorage.setItem('theme','dark'); themeToggle.textContent='â˜€ï¸'; }
    else{ localStorage.setItem('theme','light'); themeToggle.textContent='ðŸŒ™'; }
});
const savedTheme = localStorage.getItem('theme')||'light';
if(savedTheme==='dark'){ document.body.classList.add('dark-theme'); themeToggle.textContent='â˜€ï¸'; } else { themeToggle.textContent='ðŸŒ™'; }

document.getElementById('logoutBtn').addEventListener('click', ()=>{
    sessionStorage.removeItem('user');
    window.location.href='login.html';
});

renderInbox();
</script>
</body>
</html>
