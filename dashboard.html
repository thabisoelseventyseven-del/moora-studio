<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dashboard - Moora Studio</title>
<link rel="stylesheet" href="style.css">
<style>
body{font-family:Arial;background:#f5f5f5;color:#111;margin:0;transition:background 0.3s,color 0.3s;}
body.dark-theme{background:#0f0f15;color:#eee;}
.top-left-nav{display:flex;gap:12px;padding:12px 20px;align-items:center;flex-wrap:wrap;}
.btn{background:linear-gradient(135deg,#50e3c2,#ff6ec7);color:#fff;padding:10px 16px;border-radius:10px;border:none;cursor:pointer;}
.btn.small-btn{font-size:.9rem;}
.header{text-align:center;padding:40px 10px;}
.header h1{font-size:3rem;margin:0;}
.header p{font-size:1.1rem;color:#666;margin-top:6px;}
.dashboard-container{max-width:1200px;margin:auto;padding:20px;}
.dashboard-cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:24px;justify-items:center;}
.dashboard-card{background:#1c1c27;border-radius:16px;padding:25px;text-align:center;cursor:pointer;transition:transform 0.2s,box-shadow 0.2s;width:100%;box-sizing:border-box;}
.dashboard-card:hover{transform:scale(1.05);box-shadow:0 8px 20px rgba(0,0,0,0.3);}
.dashboard-card.selected{border:3px solid #ff6ec7;}
.dashboard-card div.icon{font-size:48px;margin-bottom:12px;}
.template-price{color:#ffd6f0;margin-top:12px;font-weight:bold;font-size:1.1rem;}
.message-card{background:#fff;padding:25px;border-radius:16px;box-shadow:0 4px 12px rgba(0,0,0,0.15);margin-top:30px;}
body.dark-theme .message-card{background:#1c1c27;color:#eee;}
textarea{width:100%;min-height:140px;padding:14px;border-radius:12px;border:1px solid #ccc;background:#f5f5f5;color:#111;resize:vertical;font-size:1rem;}
body.dark-theme textarea{background:#0f0f15;color:#eee;border:1px solid #333;}
#currentTemplates{font-size:1.3rem;font-weight:700;margin-top:16px;display:block;}
.status-msg{color:#50e3c2;margin-top:12px;display:none;font-weight:600;}
.badge{background:#ff6ec7;border-radius:999px;padding:2px 8px;font-size:.9rem;display:none;margin-left:6px;}
</style>
</head>

<body>

<div class="top-left-nav">
  <a class="btn small-btn" href="dashboard.html">Dashboard</a>
  <a class="btn small-btn" href="inbox.html">
    Inbox <span id="inboxBadge" class="badge">0</span>
  </a>
  <button id="themeToggle" class="btn small-btn">ðŸŒ™</button>
  <button id="logoutBtn" class="btn small-btn" style="margin-left:8px;">Logout</button>
</div>

<header class="header">
  <h1>Welcome, <span id="userName"></span></h1>
  <p>Select templates and send messages to admin</p>
</header>

<main class="dashboard-container">

<section>
  <h2 style="text-align:center">Choose Templates</h2>
  <div id="templatesContainer" class="dashboard-cards"></div>
  <p><strong>Selected:</strong> <span id="currentTemplates">None</span></p>
</section>

<section>
  <h2 style="text-align:center">Your Message</h2>
  <div class="message-card">
    <textarea id="messageBox" placeholder="Write your message here..."></textarea>
    <button id="sendBtn" class="btn" style="margin-top:16px;">Send to Admin</button>
    <p id="status" class="status-msg">Message sent to admin</p>
  </div>
</section>

</main>

<script>
// ---------- Theme ----------
const themeToggle=document.getElementById('themeToggle');
if(!localStorage.getItem('theme')) localStorage.setItem('theme','light');
if(localStorage.getItem('theme')==='dark'){document.body.classList.add('dark-theme'); themeToggle.textContent='â˜€ï¸';}
else{document.body.classList.remove('dark-theme'); themeToggle.textContent='ðŸŒ™';}
themeToggle.addEventListener('click',()=>{
  document.body.classList.toggle('dark-theme');
  themeToggle.textContent=document.body.classList.contains('dark-theme')?'â˜€ï¸':'ðŸŒ™';
  localStorage.setItem('theme',document.body.classList.contains('dark-theme')?'dark':'light');
});

// ---------- User ----------
let user=JSON.parse(sessionStorage.getItem("user"));
if(!user){user={name:"Demo User",email:"demo@example.com"}; sessionStorage.setItem("user",JSON.stringify(user));}
document.getElementById('userName').textContent=user.name;

// ---------- Templates ----------
const templates=[
  {name:"Business",price:"R250",icon:"ðŸ’¼"},
  {name:"Portfolio",price:"R200",icon:"ðŸŽ¨"},
  {name:"Landing Page",price:"R300",icon:"ðŸŒ"},
  {name:"Marketing",price:"R180",icon:"ðŸ“£"},
  {name:"CV",price:"R100",icon:"ðŸ“"},
  {name:"Report Templates",price:"R220",icon:"ðŸ“Š"},
  {name:"Analytics Dashboard",price:"R350",icon:"ðŸ“ˆ"},
  {name:"E-commerce",price:"R400",icon:"ðŸ›’"}
];
let selected=[];
const templatesContainer=document.getElementById('templatesContainer');
const currentTemplates=document.getElementById('currentTemplates');

templates.forEach(t=>{
  const card=document.createElement('div');
  card.className='dashboard-card';
  card.innerHTML=`<div class="icon">${t.icon}</div><b>${t.name}</b><div class="template-price">${t.price}</div>`;
  card.onclick=()=>{
    if(!selected.includes(t.name)){
      selected.push(t.name);
      card.classList.add('selected');
      updateSelectedDisplay();
    }
  };
  templatesContainer.appendChild(card);
});

function updateSelectedDisplay(){
  if(selected.length===0){currentTemplates.textContent="None";}
  else{
    currentTemplates.innerHTML=selected.map(name=>{
      const t=templates.find(x=>x.name===name);
      return `${t.icon} ${t.name}`;
    }).join(" | ");
  }
}

// ---------- Message Send ----------
const sendBtn=document.getElementById('sendBtn');
const messageBox=document.getElementById('messageBox');
const status=document.getElementById('status');
sendBtn.onclick=()=>{
  if(!selected.length){return alert("Select at least one template");}
  if(!messageBox.value.trim()){return alert("Write a message");}

  const inbox=JSON.parse(localStorage.getItem("inbox")||"[]");
  inbox.push({
    id:"m"+Date.now(),
    userName:user.name,
    userEmail:user.email,
    templates:[...selected],
    message:messageBox.value,
    replyText:null,
    adminVoice:null,
    replyRead:false,
    sentAt:new Date().toISOString()
  });
  localStorage.setItem("inbox",JSON.stringify(inbox));

  messageBox.value=""; selected=[]; updateSelectedDisplay();
  document.querySelectorAll(".dashboard-card.selected").forEach(e=>e.classList.remove("selected"));
  status.style.display="block";
  setTimeout(()=>status.style.display="none",2000);

  updateBadge();
};

// ---------- Inbox Notification Badge ----------
function updateBadge(){
  const inbox=JSON.parse(localStorage.getItem("inbox")||"[]");
  const unread=inbox.filter(m=>m.userEmail===user.email&&(m.replyText||m.adminVoice)&&!m.replyRead).length;
  const badge=document.getElementById("inboxBadge");
  badge.style.display=unread?"inline-block":"none";
  badge.textContent=unread;
}
updateBadge();

// ---------- Logout ----------
document.getElementById('logoutBtn').onclick=()=>{
  sessionStorage.removeItem('user');
  location.href="login.html";
};
</script>
</body>
</html>
