<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dashboard - Moora Studio</title>

<link rel="stylesheet" href="style.css">

<style>
body{font-family:Arial;background:#0f0f15;color:#eee;margin:0}
.top-left-nav{display:flex;gap:12px;padding:12px 20px}
.btn{background:linear-gradient(135deg,#50e3c2,#ff6ec7);color:#fff;padding:8px 12px;border-radius:8px;border:none;cursor:pointer;text-decoration:none}
.small-btn{font-size:.9rem}
.header{text-align:center;padding:18px}
.dashboard-container{max-width:1100px;margin:auto;padding:20px}
.dashboard-cards{display:flex;flex-wrap:wrap;gap:14px}
.dashboard-card{background:#1c1c27;border-radius:12px;padding:14px;flex:1 1 220px;text-align:center;cursor:pointer}
.dashboard-card.selected{border:2px solid #ff6ec7}
.template-price{color:#ffd6f0}
.message-card{background:#1a1a28;padding:16px;border-radius:12px}
textarea{width:100%;min-height:90px;background:#0f0f15;color:#eee;border:1px solid #333;border-radius:8px;padding:10px}
.inbox-item{background:#29293f;padding:12px;border-radius:10px;margin-bottom:10px}
.badge{background:#ff6ec7;border-radius:999px;padding:2px 8px;font-size:.8rem;display:none}
footer{text-align:center;padding:20px;color:#aaa}
</style>
</head>

<body>

<div class="top-left-nav">
  <a class="btn small-btn" href="dashboard.html">Dashboard</a>
  <a class="btn small-btn" href="inbox.html">
    Inbox <span id="inboxBadge" class="badge">0</span>
  </a>
  <button id="logoutBtn" class="btn small-btn">Logout</button>
</div>

<header class="header">
  <h1>Welcome, <span id="userName"></span></h1>
</header>

<main class="dashboard-container">

<section>
<h2>Choose Templates</h2>
<div id="templatesContainer" class="dashboard-cards"></div>
<p><strong>Selected:</strong> <span id="currentTemplates">None</span></p>
</section>

<section>
<h2>Your Message</h2>
<div class="message-card">
<textarea id="messageBox" placeholder="Write message or record voice"></textarea>
<br><br>
<button id="sendBtn" class="btn">Send to Admin</button>
<p id="status" style="color:#50e3c2;display:none"></p>
</div>
</section>

<section>
<h2>Your Inbox (Admin Replies Only)</h2>
<div id="inboxPreview"></div>
</section>

</main>

<footer>Â© 2025 Moora Studio</footer>

<script>
/* ---------- USER ---------- */
let user = JSON.parse(sessionStorage.getItem("user"));
if(!user){
  user={name:"Demo User",email:"demo@example.com"};
  sessionStorage.setItem("user",JSON.stringify(user));
}
userName.textContent=user.name;

/* ---------- STORAGE ---------- */
const getInbox=()=>JSON.parse(localStorage.getItem("inbox")||"[]");
const setInbox=d=>localStorage.setItem("inbox",JSON.stringify(d));

/* ---------- TEMPLATES ---------- */
const templates=[
{name:"Business",price:"R250",icon:"ðŸ’¼"},
{name:"Portfolio",price:"R200",icon:"ðŸŽ¨"},
{name:"Landing Page",price:"R300",icon:"ðŸŒ"},
{name:"Marketing",price:"R180",icon:"ðŸ“£"},
{name:"CV",price:"R100",icon:"ðŸ“"}
];

let selected=[];
templates.forEach(t=>{
  const d=document.createElement("div");
  d.className="dashboard-card";
  d.innerHTML=`<div style="font-size:26px">${t.icon}</div><b>${t.name}</b><div class="template-price">${t.price}</div>`;
  d.onclick=()=>{
    if(!selected.includes(t.name)){
      selected.push(t.name);
      d.classList.add("selected");
      currentTemplates.textContent=selected.join(" | ");
    }
  };
  templatesContainer.appendChild(d);
});

/* ---------- SEND MESSAGE ---------- */
sendBtn.onclick=()=>{
  if(!selected.length) return alert("Select template");
  if(!messageBox.value.trim()) return alert("Write a message");

  const inbox=getInbox();
  inbox.push({
    id:"m"+Date.now(),
    userName:user.name,
    userEmail:user.email,
    templates:[...selected],
    userMessage:messageBox.value,
    userVoice:null,
    adminReply:null,
    adminVoice:null,
    repliedAt:null,
    replyRead:false,
    sentAt:new Date().toISOString()
  });

  setInbox(inbox);
  messageBox.value="";
  selected=[];
  currentTemplates.textContent="None";
  document.querySelectorAll(".selected").forEach(e=>e.classList.remove("selected"));
  status.style.display="block";
  status.textContent="Message sent to admin";
  setTimeout(()=>status.style.display="none",2000);
  renderInboxPreview();
};

/* ---------- INBOX PREVIEW ---------- */
function renderInboxPreview(){
  const inbox=getInbox();
  const replies=inbox.filter(m=>m.userEmail===user.email && m.adminReply);
  inboxPreview.innerHTML=replies.length?"":
    "<p>No replies yet.</p>";
  replies.forEach(m=>{
    const d=document.createElement("div");
    d.className="inbox-item";
    d.innerHTML=`<b>Admin:</b><p>${m.adminReply}</p>`;
    inboxPreview.appendChild(d);
    m.replyRead=true;
  });
  setInbox(inbox);
  updateBadge();
}

function updateBadge(){
  const inbox=getInbox();
  const unread=inbox.filter(m=>m.userEmail===user.email && m.adminReply && !m.replyRead).length;
  inboxBadge.style.display=unread?"inline-block":"none";
  inboxBadge.textContent=unread;
}

renderInboxPreview();
updateBadge();

/* ---------- LOGOUT ---------- */
logoutBtn.onclick=()=>{
  sessionStorage.removeItem("user");
  location.href="login.html";
};
</script>

</body>
</html>
