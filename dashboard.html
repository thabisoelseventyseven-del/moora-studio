<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Dashboard - Moora Studio</title>
<style>
/* ---------------- GLOBAL ---------------- */
body {
    font-family: Arial, sans-serif;
    margin:0;
    background: #f5f5f5;
    color: #111;
    transition: background 0.3s, color 0.3s;
}
body.dark-theme {
    background:#0f0f15;
    color:#eee;
}

/* Top navigation */
.top-left-nav {
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    justify-content:flex-end;
    padding:12px 20px;
}
.btn {
    padding:8px 14px;
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-weight:600;
    text-decoration:none;
    background:linear-gradient(135deg,#50e3c2,#ff6ec7);
    color:#fff;
}
.small-btn { font-size:0.9rem; }

/* Header */
.header {
    text-align:center;
    padding:40px 20px 20px;
}
.header h1 { font-size:2.5rem; margin:0 0 8px; }

/* Templates Section */
.dashboard-container { max-width:1200px; margin:auto; padding:20px; }
.dashboard-cards {
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap:16px;
    margin-top:20px;
}
.dashboard-card {
    background:#ffffff;
    border-radius:12px;
    padding:20px;
    text-align:center;
    cursor:pointer;
    border:2px solid #ddd;
    transition: transform 0.2s, border 0.2s;
}
.dashboard-card:hover { transform: translateY(-4px); }
.dashboard-card.selected { border:3px solid #ff6ec7; }
.dashboard-card .icon { font-size:40px; margin-bottom:12px; }
.dashboard-card .name { font-size:1.2rem; font-weight:600; }
.dashboard-card .price { margin-top:8px; font-weight:bold; color:#ff6ec7; }

/* Selected templates display */
.selected-templates { margin-top:16px; font-size:1.2rem; font-weight:600; }
.selected-templates span { margin-right:12px; }

/* Message Box */
.message-card {
    background:#ffffff;
    border-radius:12px;
    padding:16px;
    margin-top:30px;
    box-shadow:0 3px 8px rgba(0,0,0,0.15);
}
.message-card textarea {
    width:100%;
    min-height:100px;
    border-radius:8px;
    border:1px solid #ccc;
    padding:10px;
    font-size:1rem;
}

/* Voice controls */
.voice-controls {
    display:flex;
    gap:12px;
    margin-top:12px;
    flex-wrap:wrap;
}
.voice-controls button {
    padding:6px 12px;
    border-radius:6px;
    border:none;
    cursor:pointer;
    background:#ff6ec7;
    color:white;
}

/* Footer */
footer { text-align:center; padding:20px; color:#555; }

/* Notification badge */
.badge {
    background: #ff6ec7;
    border-radius: 999px;
    padding: 2px 8px;
    font-size: 0.8rem;
    display: none;
    vertical-align: super;
}
</style>
</head>
<body>

<div class="top-left-nav">
  <a class="btn small-btn" href="dashboard.html">Dashboard</a>
  <a class="btn small-btn" href="inbox.html">
    Inbox <span id="inboxBadge" class="badge">0</span>
  </a>
  <button id="theme-toggle" class="btn small-btn">üåô</button>
  <button id="logoutBtn" class="btn small-btn">Logout</button>
</div>

<header class="header">
  <h1>Welcome, <span id="userName"></span></h1>
</header>

<main class="dashboard-container">

<!-- Templates Section -->
<section>
<h2>Choose Templates</h2>
<div id="templatesContainer" class="dashboard-cards"></div>
<p class="selected-templates"><strong>Selected:</strong> <span id="currentTemplates">None</span></p>
</section>

<!-- Message Section -->
<section class="message-card">
<h2>Your Message</h2>
<textarea id="messageBox" placeholder="Write your message here..."></textarea>
<div class="voice-controls">
    <button id="recordBtn">üé§ Record</button>
    <button id="stopBtn" disabled>‚èπ Stop</button>
    <button id="playBtn" disabled>‚ñ∂Ô∏è Play</button>
    <button id="deleteBtn" disabled>üóë Delete</button>
</div>
<button id="sendBtn" class="btn">Send to Admin</button>
<p id="status" style="color:#50e3c2;display:none;margin-top:8px"></p>
</section>

</main>

<footer>¬© 2025 Moora Studio</footer>

<script>
/* ---------------- USER ---------------- */
let user = JSON.parse(sessionStorage.getItem("user")) || { name: "Demo User", email: "demo@example.com" };
userName.textContent = user.name;

/* ---------------- STORAGE ---------------- */
const getInbox = () => JSON.parse(localStorage.getItem("inbox") || "[]");
const setInbox = d => localStorage.setItem("inbox", JSON.stringify(d));

/* ---------------- TEMPLATES ---------------- */
const templates = [
  {name:"Business",price:"R250",icon:"üíº"},
  {name:"Portfolio",price:"R200",icon:"üé®"},
  {name:"Landing Page",price:"R300",icon:"üåê"},
  {name:"Marketing",price:"R180",icon:"üì£"},
  {name:"CV",price:"R100",icon:"üìù"},
  {name:"University Apps",price:"R150",icon:"üéì"},
  {name:"Report",price:"R120",icon:"üìä"},
  {name:"Web Templates",price:"R350",icon:"üíª"}
];

let selected = [];
const templatesContainer = document.getElementById("templatesContainer");
templates.forEach(t => {
  const div = document.createElement("div");
  div.className = "dashboard-card";
  div.innerHTML = `<div class="icon">${t.icon}</div><div class="name">${t.name}</div><div class="price">${t.price}</div>`;
  div.onclick = () => {
    if(!selected.includes(t)){ selected.push(t); div.classList.add("selected"); }
    else { selected = selected.filter(s=>s!==t); div.classList.remove("selected"); }
    currentTemplates.textContent = selected.map(s=>`${s.icon} ${s.name}`).join(" | ") || "None";
  };
  templatesContainer.appendChild(div);
});

/* ---------------- MESSAGE SENDING ---------------- */
const messageBox = document.getElementById("messageBox");
const sendBtn = document.getElementById("sendBtn");
const status = document.getElementById("status");

let audioBlob, mediaRecorder, audioChunks=[];
const recordBtn = document.getElementById("recordBtn");
const stopBtn = document.getElementById("stopBtn");
const playBtn = document.getElementById("playBtn");
const deleteBtn = document.getElementById("deleteBtn");

recordBtn.onclick = async () => {
  const stream = await navigator.mediaDevices.getUserMedia({ audio:true });
  mediaRecorder = new MediaRecorder(stream);
  audioChunks=[];
  mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
  mediaRecorder.start();
  recordBtn.disabled = true; stopBtn.disabled = false;
};

stopBtn.onclick = () => {
  mediaRecorder.stop();
  mediaRecorder.onstop = () => { audioBlob = new Blob(audioChunks,{type:"audio/webm"}); playBtn.disabled=false; deleteBtn.disabled=false; };
  recordBtn.disabled=false; stopBtn.disabled=true;
};
playBtn.onclick = () => { if(audioBlob) new Audio(URL.createObjectURL(audioBlob)).play(); };
deleteBtn.onclick = () => { audioBlob=null; playBtn.disabled=true; deleteBtn.disabled=true; };

sendBtn.onclick = () => {
  if(selected.length===0) return alert("Select at least one template");
  if(!messageBox.value.trim()) return alert("Write a message");

  const inbox = getInbox();
  inbox.push({
    id:"m"+Date.now(),
    userName:user.name,
    userEmail:user.email,
    templates:[...selected],
    userMessage:messageBox.value,
    userVoice:audioBlob || null,
    adminReply:null,
    replyRead:false,
    sentAt:new Date().toISOString()
  });
  setInbox(inbox);

  messageBox.value="";
  selected=[];
  currentTemplates.textContent="None";
  document.querySelectorAll(".dashboard-card.selected").forEach(e=>e.classList.remove("selected"));
  audioBlob=null; stopBtn.disabled=true; playBtn.disabled=true; deleteBtn.disabled=true;

  status.style.display="block"; status.textContent="Message sent to inbox";
  setTimeout(()=>status.style.display="none",2000);
  updateBadge();
};

/* ---------------- NOTIFICATION ---------------- */
const inboxBadge = document.getElementById("inboxBadge");
function updateBadge(){
  const inbox = getInbox();
  const unread = inbox.filter(m=>m.userEmail===user.email && !m.replyRead && m.adminReply).length;
  inboxBadge.style.display = unread ? "inline-block" : "none";
  inboxBadge.textContent = unread;
}
updateBadge();

/* ---------------- LOGOUT ---------------- */
document.getElementById("logoutBtn").onclick = () => { sessionStorage.removeItem("user"); location.href="login.html"; };

/* ---------------- THEME TOGGLE ---------------- */
const themeToggle = document.getElementById("theme-toggle");
themeToggle.textContent="üåô"; // light default
themeToggle.onclick = () => {
  document.body.classList.toggle("dark-theme");
  themeToggle.textContent = document.body.classList.contains("dark-theme") ? "‚òÄÔ∏è":"üåô";
  localStorage.setItem("theme",document.body.classList.contains("dark-theme")?"dark":"light");
};
</script>
</body>
</html>
