<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard - Moora Studio</title>
<link rel="stylesheet" href="style.css">
<style>
/* Dashboard Specific Styles */
.dashboard-container { max-width:1100px; margin:2em auto; padding:0 20px; }

.dashboard-section { margin-bottom:2em; }
.dashboard-cards { display:flex; flex-wrap:wrap; gap:16px; margin-top:1em; }
.dashboard-card { background: #1c1c27; border-radius:12px; padding:1em; flex:1 1 200px; cursor:pointer; color:#fff; text-align:center; }
.dashboard-card.selected-template { border:2px solid #ff6ec7; background:#29293f; }

.template-price { margin-top:6px; font-size:0.95rem; color:#ffd6f0; }

/* Message Box */
#messageBox { width:100%; min-height:100px; padding:10px; border-radius:10px; border:1px solid #333; background:#0f0f15; color:#eee; resize:vertical; font-size:1rem; }

#guidanceMsg { margin:0.5em 0 1em 0; font-size:1rem; color:#ff6ec7; }

/* Voice note upload */
.voice-container { margin-top:0.5em; display:flex; align-items:center; gap:10px; }
.voice-container audio { height:40px; }
.voice-container button { padding:4px 8px; background:#ff4d4d; border:none; color:#fff; border-radius:6px; cursor:pointer; font-size:0.8rem; }

.send-btn { margin-top:8px; padding:8px 16px; background:linear-gradient(135deg,#50e3c2,#ff6ec7); border:none; color:white; border-radius:8px; font-weight:bold; cursor:pointer; }

@media (max-width:720px){ .dashboard-cards { flex-direction:column; } }

</style>
</head>
<body>

<!-- Floating Dots -->
<div class="floating-dots"><span></span><span></span><span></span><span></span><span></span></div>

<!-- Top Navigation -->
<div class="top-left-nav">
    <a href="dashboard.html" class="btn small-btn">Dashboard</a>
    <a href="inbox.html" class="btn small-btn">Inbox</a>
    <button id="logoutBtn" class="btn small-btn">Logout</button>
    <button id="theme-toggle" class="btn small-btn">‚òÄÔ∏è</button>
</div>

<header class="header">
    <h1>Welcome, <span id="userName"></span></h1>
    <p class="tagline">Select templates and send messages</p>
</header>

<section class="dashboard-container">

    <div class="dashboard-section">
        <h2>Available Templates</h2>
        <p>Select any template(s) (multiple allowed, no duplicates):</p>
        <div class="dashboard-cards" id="templatesContainer"></div>
    </div>

    <div class="dashboard-section">
        <h2>Your Message</h2>
        <p id="guidanceMsg">Write your message below. You can also attach a voice note.</p>
        <div class="dashboard-card">
            <h3 id="currentTemplate">No template selected</h3>
            <textarea id="messageBox" placeholder="Write your message here..."></textarea>

            <!-- Voice note upload -->
            <div class="voice-container">
                <input type="file" id="voiceInput" accept="audio/*">
                <button id="deleteVoiceBtn">Delete Voice Note</button>
            </div>

            <button class="send-btn" id="sendMessageBtn">Send Message</button>
        </div>
    </div>

</section>

<footer class="footer">
    <p><strong>Contact Us</strong></p>
    <p>üìõ Name: Thabiso Mosesi</p>
    <p>üìû Phone: 072 176 9099</p>
    <p>‚úâÔ∏è Email: thabisoelseventyseven@gmail.com</p>
    <div class="social-icons">
        <a href="#">üìò</a>
        <a href="#">üê¶</a>
        <a href="#">üì∏</a>
        <a href="#">üí¨</a>
    </div>
    <p class="copyright">¬© 2025 Moora Studio</p>
</footer>

<script>
// Theme toggle
const themeToggle = document.getElementById("theme-toggle");
const savedTheme = localStorage.getItem("theme") || "dark";
if(savedTheme==="light"){ document.body.classList.add("light-theme"); themeToggle.textContent="üåô"; } 
else { themeToggle.textContent="‚òÄÔ∏è"; }
themeToggle.addEventListener("click", ()=>{
    document.body.classList.toggle("light-theme");
    if(document.body.classList.contains("light-theme")){ themeToggle.textContent="üåô"; localStorage.setItem("theme","light"); }
    else { themeToggle.textContent="‚òÄÔ∏è"; localStorage.setItem("theme","dark"); }
});

// Logout
document.getElementById("logoutBtn").addEventListener("click",()=>{
    sessionStorage.clear();
    window.location.href="login.html";
});

// Load user
const user = JSON.parse(sessionStorage.getItem("user"));
if(!user) window.location.href="login.html";
else document.getElementById("userName").textContent=user.name||"User";

// Templates
let templates = [
    {name:"Business Templates", icon:"üíº"},
    {name:"Portfolio Templates", icon:"üé®"},
    {name:"Landing Pages", icon:"üåê"},
    {name:"Marketing Materials", icon:"üì£"},
    {name:"CV Creation", icon:"üìù"},
    {name:"University Application", icon:"üéì"},
    {name:"Report Templates", icon:"üìä"},
    {name:"Web Templates", icon:"üíª"}
];

let selectedTemplates = [];
const templatesContainer = document.getElementById("templatesContainer");
const currentTemplate = document.getElementById("currentTemplate");

function renderTemplates(){
    templatesContainer.innerHTML="";
    templates.forEach((tpl)=>{
        const div=document.createElement("div");
        div.className="dashboard-card";
        div.innerHTML=`<h3 style="font-size:2rem">${tpl.icon} ${tpl.name}</h3>`;
        div.addEventListener("click",()=>{
            if(selectedTemplates.includes(tpl.name)){ alert("Already selected."); return; }
            selectedTemplates.push(tpl.name);
            div.classList.add("selected-template");
            currentTemplate.textContent = selectedTemplates.join(" | ");
        });
        templatesContainer.appendChild(div);
    });
}
renderTemplates();

// Voice note handling
let voiceFile=null;
const voiceInput = document.getElementById("voiceInput");
const deleteVoiceBtn = document.getElementById("deleteVoiceBtn");
voiceInput.addEventListener("change", ()=>{
    if(voiceInput.files.length>0) voiceFile=voiceInput.files[0];
});
deleteVoiceBtn.addEventListener("click", ()=>{
    voiceFile=null;
    voiceInput.value="";
    alert("Voice note removed.");
});

// Send message
document.getElementById("sendMessageBtn").addEventListener("click",()=>{
    const msgText = document.getElementById("messageBox").value.trim();
    if(selectedTemplates.length===0){ alert("Select at least one template."); return; }
    if(!msgText && !voiceFile){ alert("Message or voice note required."); return; }

    // Save voice as Data URL
    if(voiceFile){
        const reader = new FileReader();
        reader.onload = function(e){
            saveMessage(msgText, e.target.result);
        }
        reader.readAsDataURL(voiceFile);
    } else saveMessage(msgText,null);
});

function saveMessage(text,voice){
    const inbox = JSON.parse(localStorage.getItem("inbox")||"[]");
    inbox.push({
        user: user.name,
        email: user.email,
        templates: [...selectedTemplates],
        message: text,
        voice: voice || null,
        reply: null,
        adminVoice: null,
        sentAt: new Date().toISOString()
    });
    localStorage.setItem("inbox",JSON.stringify(inbox));
    alert("Message sent!");
    document.getElementById("messageBox").value="";
    voiceFile=null;
    voiceInput.value="";
    selectedTemplates=[];
    currentTemplate.textContent="No template selected";
    renderTemplates();
}
</script>

</body>
</html>
