<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dashboard - Moora Studio</title>
<link rel="stylesheet" href="style.css">
<style>
body {
    font-family: Arial, sans-serif;
    background: #f5f5f5; /* light mode by default */
    color: #111;
    margin: 0;
    transition: background 0.3s, color 0.3s;
}
body.dark-theme {
    background: #0f0f15;
    color: #eee;
}

/* Top navigation */
.top-left-nav {
    display: flex;
    justify-content: flex-end;
    gap: 12px;
    padding: 12px 20px;
}
.btn {
    background: linear-gradient(135deg,#50e3c2,#ff6ec7);
    color: #fff;
    padding: 8px 14px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    font-weight: 600;
    text-decoration: none;
}
.small-btn { font-size: 0.9rem; }

/* Header */
.header {
    text-align: center;
    padding: 40px 20px 20px;
}
.header h1 {
    font-size: 2.5rem;
    margin: 0 0 8px;
}

/* Dashboard container */
.dashboard-container {
    max-width: 1200px;
    margin: auto;
    padding: 20px;
}

/* Template section */
.dashboard-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 16px;
    margin-top: 20px;
}
.dashboard-card {
    background: #1c1c27;
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    cursor: pointer;
    transition: transform 0.2s, border 0.2s;
}
.dashboard-card:hover { transform: translateY(-4px); }
.dashboard-card.selected {
    border: 3px solid #ff6ec7;
}
.dashboard-card .icon {
    font-size: 40px;
    margin-bottom: 12px;
}
.dashboard-card .name {
    font-size: 1.2rem;
    font-weight: 600;
}
.dashboard-card .price {
    margin-top: 8px;
    font-weight: bold;
    color: #ffd6f0;
}

/* Selected templates display */
.selected-templates {
    margin-top: 16px;
    font-size: 1.2rem;
    font-weight: 600;
}
.selected-templates span {
    margin-right: 12px;
}

/* Message card */
.message-card {
    background: #1a1a28;
    border-radius: 12px;
    padding: 16px;
    margin-top: 30px;
}
.message-card textarea {
    width: 100%;
    min-height: 100px;
    background: inherit;
    color: inherit;
    border: 1px solid #333;
    border-radius: 8px;
    padding: 10px;
}
.message-card button {
    margin-top: 12px;
}

/* Voice controls */
.voice-controls {
    display: flex;
    gap: 12px;
    margin-top: 12px;
    align-items: center;
}
.voice-controls button {
    padding: 6px 12px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    background: #ff4d4d;
    color: white;
}

/* Footer */
footer {
    text-align: center;
    padding: 20px;
    color: #aaa;
}

/* Notification badge */
.badge {
    background: #ff6ec7;
    border-radius: 999px;
    padding: 2px 8px;
    font-size: 0.8rem;
    display: none;
    vertical-align: super;
}
</style>
</head>

<body>

<div class="top-left-nav">
  <a class="btn small-btn" href="dashboard.html">Dashboard</a>
  <a class="btn small-btn" href="inbox.html">
    Inbox <span id="inboxBadge" class="badge">0</span>
  </a>
  <button id="theme-toggle" class="btn small-btn">üåô</button>
  <button id="logoutBtn" class="btn small-btn">Logout</button>
</div>

<header class="header">
  <h1>Welcome, <span id="userName"></span></h1>
</header>

<main class="dashboard-container">

<section>
<h2>Choose Templates</h2>
<div id="templatesContainer" class="dashboard-cards"></div>
<p class="selected-templates"><strong>Selected:</strong> <span id="currentTemplates">None</span></p>
</section>

<section class="message-card">
<h2>Your Message</h2>
<textarea id="messageBox" placeholder="Write your message here..."></textarea>

<div class="voice-controls">
    <button id="recordBtn">üé§ Record</button>
    <button id="stopBtn" disabled>‚èπ Stop</button>
    <button id="playBtn" disabled>‚ñ∂Ô∏è Play</button>
    <button id="deleteBtn" disabled>üóë Delete</button>
</div>

<button id="sendBtn" class="btn">Send to Admin</button>
<p id="status" style="color:#50e3c2;display:none;margin-top:8px"></p>
</section>

</main>

<footer>¬© 2025 Moora Studio</footer>

<script>
/* ---------------- USER ---------------- */
let user = JSON.parse(sessionStorage.getItem("user"));
if(!user){
  user = { name: "Demo User", email: "demo@example.com" };
  sessionStorage.setItem("user", JSON.stringify(user));
}
userName.textContent = user.name;

/* ---------------- STORAGE ---------------- */
const getInbox = () => JSON.parse(localStorage.getItem("inbox") || "[]");
const setInbox = d => localStorage.setItem("inbox", JSON.stringify(d));

/* ---------------- TEMPLATES ---------------- */
const templates = [
  {name:"Business",price:"R250",icon:"üíº"},
  {name:"Portfolio",price:"R200",icon:"üé®"},
  {name:"Landing Page",price:"R300",icon:"üåê"},
  {name:"Marketing",price:"R180",icon:"üì£"},
  {name:"CV",price:"R100",icon:"üìù"},
  {name:"Report",price:"R220",icon:"üìä"},
  {name:"Blog",price:"R200",icon:"üñäÔ∏è"},
  {name:"E-Commerce",price:"R350",icon:"üõí"}
];

let selected = [];
const templatesContainer = document.getElementById("templatesContainer");
templates.forEach(t => {
  const div = document.createElement("div");
  div.className = "dashboard-card";
  div.innerHTML = `<div class="icon">${t.icon}</div><div class="name">${t.name}</div><div class="price">${t.price}</div>`;
  div.onclick = () => {
    if(!selected.includes(t)){
      selected.push(t);
      div.classList.add("selected");
    } else {
      selected = selected.filter(s => s !== t);
      div.classList.remove("selected");
    }
    const display = selected.map(s => `${s.icon} ${s.name}`).join(" | ") || "None";
    currentTemplates.textContent = display;
  };
  templatesContainer.appendChild(div);
});

/* ---------------- MESSAGE SENDING ---------------- */
const messageBox = document.getElementById("messageBox");
const sendBtn = document.getElementById("sendBtn");
const status = document.getElementById("status");

sendBtn.onclick = () => {
  if(selected.length === 0) return alert("Select at least one template");
  if(!messageBox.value.trim()) return alert("Write a message");

  const inbox = getInbox();
  inbox.push({
    id: "m" + Date.now(),
    userName: user.name,
    userEmail: user.email,
    templates: [...selected],
    userMessage: messageBox.value,
    userVoice: audioBlob ? audioBlob : null,
    adminReply: null,
    replyRead: false,
    sentAt: new Date().toISOString()
  });
  setInbox(inbox);

  messageBox.value = "";
  selected = [];
  currentTemplates.textContent = "None";
  document.querySelectorAll(".dashboard-card.selected").forEach(e=>e.classList.remove("selected"));
  audioBlob = null;
  stopBtn.disabled = true; playBtn.disabled = true; deleteBtn.disabled = true;

  status.style.display = "block";
  status.textContent = "Message sent to inbox";
  setTimeout(()=>status.style.display="none",2000);
  updateBadge();
};

/* ---------------- NOTIFICATION BADGE ---------------- */
function updateBadge(){
  const inbox = getInbox();
  const unread = inbox.filter(m=>m.userEmail===user.email && !m.replyRead && m.adminReply).length;
  inboxBadge.style.display = unread ? "inline-block" : "none";
  inboxBadge.textContent = unread;
}
updateBadge();

/* ---------------- VOICE RECORDING ---------------- */
let mediaRecorder, audioChunks = [], audioBlob;
const recordBtn = document.getElementById("recordBtn");
const stopBtn = document.getElementById("stopBtn");
const playBtn = document.getElementById("playBtn");
const deleteBtn = document.getElementById("deleteBtn");

recordBtn.onclick = async () => {
  if(!navigator.mediaDevices?.getUserMedia){ alert("Recording not supported"); return; }
  const stream = await navigator.mediaDevices.getUserMedia({ audio:true });
  mediaRecorder = new MediaRecorder(stream);
  audioChunks = [];
  mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
  mediaRecorder.start();
  recordBtn.disabled = true; stopBtn.disabled = false;
};

stopBtn.onclick = () => {
  mediaRecorder.stop();
  mediaRecorder.onstop = () => {
    audioBlob = new Blob(audioChunks, { type:"audio/webm" });
    const url = URL.createObjectURL(audioBlob);
    playBtn.disabled = false; deleteBtn.disabled = false;
  };
  recordBtn.disabled = false; stopBtn.disabled = true;
};

playBtn.onclick = () => {
  if(audioBlob){
    const url = URL.createObjectURL(audioBlob);
    const audio = new Audio(url);
    audio.play();
  }
};

deleteBtn.onclick = () => {
  audioBlob = null;
  playBtn.disabled = true; deleteBtn.disabled = true;
};

/* ---------------- LOGOUT ---------------- */
document.getElementById("logoutBtn").onclick = () => {
  sessionStorage.removeItem("user");
  location.href = "login.html";
};

/* ---------------- THEME TOGGLE ---------------- */
const themeToggle = document.getElementById("theme-toggle");
if(localStorage.getItem("theme")==="dark") document.body.classList.add("dark-theme");
themeToggle.textContent = document.body.classList.contains("dark-theme") ? "‚òÄÔ∏è" : "üåô";
themeToggle.onclick = () => {
  document.body.classList.toggle("dark-theme");
  themeToggle.textContent = document.body.classList.contains("dark-theme") ? "‚òÄÔ∏è" : "üåô";
  localStorage.setItem("theme", document.body.classList.contains("dark-theme") ? "dark" : "light");
};
</script>

</body>
</html>
