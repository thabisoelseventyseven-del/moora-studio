<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inbox - Moora Studio</title>
<link rel="stylesheet" href="style.css">
<style>
body {
    font-family: Arial;
    margin:0;
    background: #f5f5f5; /* Light mode default */
    color: #222;
    transition: background 0.3s, color 0.3s;
}
body.dark-theme {
    background: #0f0f15;
    color: #eee;
}
.top-left-nav {
    display:flex;
    gap:12px;
    padding:12px 20px;
    align-items:center;
    background: inherit;
}
.btn {
    background: linear-gradient(135deg,#50e3c2,#ff6ec7);
    color: #fff;
    padding: 10px 16px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    text-decoration: none;
    font-weight: bold;
}
.small-btn { font-size:0.9rem; }

.header {
    text-align:center;
    padding:30px 10px;
}
.header h1 { font-size:2.2rem; margin-bottom:6px; }
.header p { font-size:1rem; color:#888; }

.inbox-container {
    max-width: 900px;
    margin: 0 auto 60px;
    padding: 0 20px;
}

.inbox-card {
    background: #fff;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    color: #222;
}
body.dark-theme .inbox-card {
    background: #1c1c27;
    color: #fff;
}
.inbox-card b { font-size:1.1rem; }
.inbox-card p { margin:6px 0; }
.inbox-card small { color:#888; display:block; margin-top:8px; }
.inbox-card audio { width:100%; margin-top:10px; }

.empty { text-align:center; color:#c9c9c9; padding:36px; background:#0f1013; border-radius:10px; }

footer {
    text-align:center;
    padding:30px;
    color:#555;
}
</style>
</head>
<body>

<div class="top-left-nav">
  <a href="dashboard.html" class="btn small-btn">Dashboard</a>
  <button id="themeToggle" class="btn small-btn">ðŸŒ™</button>
</div>

<header class="header">
  <h1>Inbox</h1>
  <p>View admin replies to your messages</p>
</header>

<section class="inbox-container" id="inboxContainer"></section>

<footer>
    <p>Â© 2025 Moora Studio â€” contact: thabisoelseventyseven@gmail.com</p>
</footer>

<script>
// ----------------- THEME -----------------
const themeToggle = document.getElementById("themeToggle");
const savedTheme = localStorage.getItem("theme") || "light";
if(savedTheme==="dark"){ document.body.classList.add("dark-theme"); themeToggle.textContent="â˜€ï¸"; } 
else themeToggle.textContent="ðŸŒ™";

themeToggle.addEventListener("click", ()=>{
    document.body.classList.toggle("dark-theme");
    if(document.body.classList.contains("dark-theme")){
        themeToggle.textContent="â˜€ï¸";
        localStorage.setItem("theme","dark");
    } else {
        themeToggle.textContent="ðŸŒ™";
        localStorage.setItem("theme","light");
    }
});

// ----------------- USER CHECK -----------------
const user = JSON.parse(sessionStorage.getItem("user"));
if(!user) location.href="login.html";

// ----------------- INBOX -----------------
const inboxContainer = document.getElementById("inboxContainer");

function renderInbox(){
    const inbox = JSON.parse(localStorage.getItem("inbox")||"[]");
    // Only show admin replies
    const replies = inbox.filter(m=>m.userEmail===user.email && (m.adminReply || m.adminVoice));
    inboxContainer.innerHTML="";

    if(replies.length===0){
        inboxContainer.innerHTML="<div class='empty'>No admin replies yet.</div>";
        return;
    }

    replies.forEach((msg)=>{
        const div = document.createElement("div");
        div.className="inbox-card";

        const audioHTML = msg.adminVoice ? `<audio controls src="${msg.adminVoice}"></audio>` : "";

        div.innerHTML = `
            <b>Admin Reply:</b>
            <p>${msg.adminReply || "(No text reply)"}</p>
            ${audioHTML}
            <small>Templates: ${msg.templates ? msg.templates.join(" | ") : "(none)"}</small>
        `;
        inboxContainer.appendChild(div);

        // Mark as read
        if(!msg.replyRead) msg.replyRead = true;
    });

    localStorage.setItem("inbox", JSON.stringify(inbox));
    updateBadge();
}

// ----------------- BADGE -----------------
const inboxBadge = document.querySelector("#inboxBadge");
function updateBadge(){
    const inbox = JSON.parse(localStorage.getItem("inbox")||"[]");
    const unread = inbox.filter(m=>m.userEmail===user.email && (m.adminReply || m.adminVoice) && !m.replyRead).length;
    if(inboxBadge) {
        inboxBadge.style.display = unread? "inline-block":"none";
        inboxBadge.textContent = unread;
    }
}

renderInbox();
updateBadge();
</script>

</body>
</html>
