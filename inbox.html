<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Inbox - Moora Studio</title>
<link rel="stylesheet" href="style.css">
<style>
body { font-family: Arial, sans-serif; background:#f5f5f5; color:#111; margin:0; transition: background 0.3s, color 0.3s; }
body.dark-theme { background:#0f0f15; color:#eee; }

/* Top Navigation */
.top-left-nav { display:flex; gap:12px; padding:12px 20px; align-items:center; }
.btn { background:linear-gradient(135deg,#50e3c2,#ff6ec7); color:#fff; padding:8px 14px; border-radius:8px; border:none; cursor:pointer; }
.btn.small-btn { font-size:0.9rem; }
.header { text-align:center; padding:24px 10px; }
.header h1 { font-size:2rem; margin:0; }
.header p { font-size:1rem; color:#666; }

/* Inbox */
.inbox-container { max-width:900px; margin:30px auto; padding:0 20px; }
.inbox-card { background:#fff; border-radius:14px; padding:16px; margin-bottom:16px; box-shadow:0 4px 12px rgba(0,0,0,0.15); }
body.dark-theme .inbox-card { background:#1c1c27; color:#eee; }
.inbox-card h3 { margin:0 0 8px 0; font-size:1.1rem; }
.inbox-card p { margin:6px 0; }
.inbox-card audio { width:100%; margin-top:6px; }
.badge { display:inline-block; background:#ff6ec7; color:#fff; padding:4px 10px; border-radius:999px; font-weight:700; margin-left:6px; }

/* Empty state */
.empty { text-align:center; color:#888; padding:36px; background:#e0e0e0; border-radius:12px; }
body.dark-theme .empty { background:#0b0b11; color:#888; }

/* Footer */
footer { text-align:center; padding:20px; color:#666; }
</style>
</head>
<body>

<div class="top-left-nav">
  <a href="dashboard.html" class="btn small-btn">Dashboard</a>
  <button id="themeToggle" class="btn small-btn">ðŸŒ™</button>
</div>

<header class="header">
  <h1>Inbox</h1>
  <p>Only admin replies appear here. New replies show notifications.</p>
</header>

<div class="inbox-container" id="inboxContainer"></div>

<footer>
  <p>Â© 2025 Moora <strong>Studio</strong></p>
</footer>

<script>
// ---------- Theme ----------
const themeToggle = document.getElementById('themeToggle');
if(localStorage.getItem('theme')==='light'){ document.body.classList.remove('dark-theme'); themeToggle.textContent='ðŸŒ™'; } 
else { document.body.classList.add('dark-theme'); themeToggle.textContent='â˜€ï¸'; }

themeToggle.addEventListener('click', ()=>{
  document.body.classList.toggle('dark-theme');
  themeToggle.textContent = document.body.classList.contains('dark-theme') ? 'â˜€ï¸' : 'ðŸŒ™';
  localStorage.setItem('theme', document.body.classList.contains('dark-theme') ? 'dark' : 'light');
});

// ---------- User ----------
const user = JSON.parse(sessionStorage.getItem("user"));
if(!user){ alert("Please login"); window.location.href='login.html'; }

// ---------- Inbox ----------
const inboxContainer = document.getElementById('inboxContainer');

function renderInbox(){
    const inbox = JSON.parse(localStorage.getItem('inbox') || "[]");
    const replies = inbox.filter(m=>m.userEmail===user.email && (m.replyText || m.adminVoice));
    inboxContainer.innerHTML = '';

    if(replies.length===0){
        inboxContainer.innerHTML="<div class='empty'>No replies yet.</div>";
        updateBadge(0);
        return;
    }

    replies.forEach((msg,idx)=>{
        const card = document.createElement('div');
        card.className='inbox-card';
        card.innerHTML = `
            <h3>From Admin <span class="badge">${msg.replyRead===false ? 'NEW' : ''}</span></h3>
            ${msg.replyText ? `<p>${msg.replyText}</p>` : ''}
            ${msg.adminVoice ? `<audio controls src="${msg.adminVoice}"></audio>` : ''}
            <small>Templates: ${msg.templates.join(' | ')}</small>
        `;
        inboxContainer.appendChild(card);
        // Mark as read
        msg.replyRead=true;
    });

    localStorage.setItem('inbox',JSON.stringify(inbox));
    updateBadge(replies.filter(r=>r.replyRead===false).length);
}

function updateBadge(count){
    // Update dashboard badge if exists
    const badge = document.getElementById('inboxBadge');
    if(badge){
        badge.style.display=count>0?'inline-block':'none';
        badge.textContent=count;
    }
}

// ---------- Initial render ----------
renderInbox();
</script>

</body>
</html>
