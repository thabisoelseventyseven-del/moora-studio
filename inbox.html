<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inbox - Moora Studio</title>
<link rel="stylesheet" href="style.css">
<style>
body{background:#0f0f15;color:#eee;font-family:Arial;margin:0;padding:0}
.top-left-nav{display:flex;gap:12px;padding:12px 20px;align-items:center}
.btn{background:linear-gradient(135deg,#50e3c2,#ff6ec7);color:#fff;padding:8px 12px;border-radius:8px;border:none;cursor:pointer;text-decoration:none}
.small-btn{font-size:.9rem;}
.header{text-align:center;padding:18px;}
.inbox-container{max-width:900px;margin:30px auto;padding:20px}
.card{background:#1c1c27;border-radius:12px;padding:14px;margin-bottom:12px;color:#fff}
.card audio{width:100%;margin-top:8px}
.card small{color:#c9c9c9;display:block;margin-top:6px}
.empty{text-align:center;color:#c9c9c9;padding:36px;background:#0f1013;border-radius:10px}
</style>
</head>

<body>

<div class="top-left-nav">
  <a href="dashboard.html" class="btn small-btn">Dashboard</a>
  <button id="themeToggle" class="btn small-btn">‚òÄÔ∏è</button>
</div>

<header class="header">
  <h2>Inbox</h2>
  <p class="tagline">Admin replies for your messages</p>
</header>

<section class="inbox-container" id="inboxContainer"></section>

<script>
// Theme toggle
const themeToggle = document.getElementById("themeToggle");
const savedTheme = localStorage.getItem("theme") || "dark";
if(savedTheme==="light"){ document.body.classList.add("light-theme"); themeToggle.textContent="üåô"; } 
else themeToggle.textContent="‚òÄÔ∏è";

themeToggle.addEventListener("click", ()=>{
    document.body.classList.toggle("light-theme");
    if(document.body.classList.contains("light-theme")){
        themeToggle.textContent="üåô"; localStorage.setItem("theme","light");
    } else {
        themeToggle.textContent="‚òÄÔ∏è"; localStorage.setItem("theme","dark");
    }
});

// User check
const user = JSON.parse(sessionStorage.getItem("user"));
if(!user) location.href="login.html";

// Inbox rendering
const inboxContainer = document.getElementById("inboxContainer");

function renderInbox(){
    const inbox = JSON.parse(localStorage.getItem("inbox")||"[]");
    const replies = inbox.filter(m=>m.userEmail===user.email && (m.adminReply || m.adminVoice));

    inboxContainer.innerHTML = "";
    if(replies.length===0){
        inboxContainer.innerHTML = "<div class='empty'>No admin replies yet.</div>";
        return;
    }

    replies.forEach((msg,index)=>{
        const div = document.createElement("div");
        div.className = "card";

        let audioHTML = "";
        if(msg.adminVoice){
            audioHTML = `<audio controls src="${msg.adminVoice}"></audio>`;
        }

        div.innerHTML = `
            <b>Admin Reply:</b>
            <p>${msg.adminReply || "(No text reply)"}</p>
            ${audioHTML}
            <small>Templates: ${msg.templates ? msg.templates.join(" | ") : "(none)"}</small>
        `;

        inboxContainer.appendChild(div);

        // Mark as read
        if(!msg.replyRead) msg.replyRead = true;
    });

    localStorage.setItem("inbox", JSON.stringify(inbox));
}

renderInbox();
</script>

</body>
</html>
