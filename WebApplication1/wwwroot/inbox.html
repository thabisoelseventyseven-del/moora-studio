<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inbox - Moora Studio</title>
<link rel="stylesheet" href="style.css">

<style>
/* PRO INBOX DESIGN */

.inbox-container {
    max-width: 900px;
    margin: auto;
    padding: 1.5em;
}

.inbox-title {
    font-size: 2.2rem;
    margin-bottom: 0.5em;
}

.inbox-card {
    background: #1d1d29;
    padding: 1em 1.5em;
    border-radius: 12px;
    margin-bottom: 1.2em;
    border-left: 5px solid #ff6ec7;
    transition: 0.3s;
}

.inbox-card:hover {
    transform: scale(1.02);
}

.inbox-card h3 {
    margin-top: 0;
    font-size: 1.5rem;
    color: #ff9be3;
}

.message-text {
    margin: 0.6em 0;
    font-size: 1rem;
}

.reply-box {
    margin-top: 1em;
    background: #11111b;
    padding: 0.8em;
    border-radius: 8px;
    border-left: 3px solid #62d0ff;
}

.reply-box p {
    margin: 0;
    color: #bceaff;
}

.status-pill {
    padding: 4px 10px;
    border-radius: 50px;
    font-size: 0.8rem;
    font-weight: bold;
    display: inline-block;
}

.status-pending {
    background: orange;
    color: black;
}

.status-replied {
    background: #42ff7b;
    color: black;
}

/* Delete button */
.delBtn {
    margin-top: 1em;
    background: #ff4f6d;
    padding: 6px 12px;
    border-radius: 8px;
    border: none;
    color: white;
    cursor: pointer;
}
.delBtn:hover {
    background: #d93652;
}

/* Badge fix for light theme */
body.light-theme .inbox-card {
    background: #ffffff;
    border-left: 5px solid #e84bbd;
}

</style>
</head>
<body>

<!-- Top Navigation -->
<div class="top-left-nav">
    <a href="dashboard.html" class="btn small-btn">Dashboard</a>

    <button id="theme-toggle" class="btn small-btn">‚òÄÔ∏è</button>
</div>

<header class="header">
    <h1 class="inbox-title">Your Inbox</h1>
    <p class="tagline">Messages sent to Moora Studio and admin replies</p>
</header>

<div class="inbox-container" id="inboxContainer">
    <!-- Messages auto-generated by JavaScript -->
</div>

<script>
// Theme toggle
const themeToggle = document.getElementById("theme-toggle");
const savedTheme = localStorage.getItem("theme") || "dark";

if(savedTheme === "light") {
    document.body.classList.add("light-theme");
    themeToggle.textContent = "üåô";
} else {
    themeToggle.textContent = "‚òÄÔ∏è";
}

themeToggle.addEventListener("click", () => {
    document.body.classList.toggle("light-theme");
    if(document.body.classList.contains("light-theme")){
        themeToggle.textContent = "üåô";
        localStorage.setItem("theme","light");
    } else {
        themeToggle.textContent = "‚òÄÔ∏è";
        localStorage.setItem("theme","dark");
    }
});

// Load user
const user = JSON.parse(sessionStorage.getItem("user"));
if(!user) window.location.href = "login.html";

// Inbox logic
function loadInbox(){
    const inbox = JSON.parse(localStorage.getItem("inbox") || "[]");
    const userInbox = inbox.filter(x => x.email === user.email);

    const container = document.getElementById("inboxContainer");
    container.innerHTML = "";

    if(userInbox.length === 0){
        container.innerHTML = `<p>No messages yet.</p>`;
        return;
    }

    userInbox.forEach((msg, index) => {
        const card = document.createElement("div");
        card.classList.add("inbox-card");

        const status = msg.reply ? 
            `<span class="status-pill status-replied">Replied</span>` :
            `<span class="status-pill status-pending">Pending</span>`;

        card.innerHTML = `
            <h3>${msg.templates.join(" | ")} ${status}</h3>
            <p class="message-text"><strong>Your Message:</strong><br>${msg.message}</p>

            ${msg.reply ? `
                <div class="reply-box">
                    <p><strong>Admin Reply:</strong></p>
                    <p>${msg.reply}</p>
                </div>` 
            : ``}

            <button class="delBtn" onclick="deleteMsg(${index})">Delete</button>
        `;

        container.appendChild(card);
    });
}

function deleteMsg(i){
    let inbox = JSON.parse(localStorage.getItem("inbox") || "[]");
    let userInbox = inbox.filter(x => x.email === user.email);
    let target = userInbox[i];

    let actualIndex = inbox.findIndex(m => 
        m.email === target.email &&
        m.message === target.message &&
        JSON.stringify(m.templates) === JSON.stringify(target.templates)
    );

    if(actualIndex > -1){
        inbox.splice(actualIndex, 1);
        localStorage.setItem("inbox", JSON.stringify(inbox));
    }

    loadInbox();
}

loadInbox();
</script>

</body>
</html>
